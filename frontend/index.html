<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accountant AI Agent - Excel Analysis System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            display: flex;
            flex-direction: column;
            border-radius: 20px 0 0 20px;
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tagline {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .upload-section {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .upload-area:hover {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .upload-area.dragover {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 12px;
            opacity: 0.6;
        }

        .file-input {
            display: none;
        }

        .files-list {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .files-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 12px;
            opacity: 0.7;
        }

        .file-remove {
            background: rgba(231, 76, 60, 0.2);
            border: none;
            color: #e74c3c;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .file-remove:hover {
            background: rgba(231, 76, 60, 0.3);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .header {
            padding: 25px 30px;
            border-bottom: 1px solid #e0e6ed;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .header-top {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            background: white;
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .mode-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 30px;
            gap: 20px;
        }

        .chat-messages {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            overflow-y: auto;
            max-height: 500px;
            border: 1px solid #e9ecef;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .message-content {
            flex: 1;
            max-width: 70%;
        }

        .message-bubble {
            padding: 15px 20px;
            border-radius: 18px;
            margin-bottom: 5px;
            line-height: 1.5;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            margin-left: auto;
        }

        .message.ai .message-bubble {
            background: white;
            border: 1px solid #e9ecef;
            color: #333;
        }

        .message-time {
            font-size: 12px;
            opacity: 0.6;
            text-align: right;
        }

        .message.ai .message-time {
            text-align: left;
        }

        .chat-input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 16px;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .analysis-panel {
            display: none;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 30px;
        }

        .analysis-panel.active {
            display: block;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .card-content {
            color: #666;
            line-height: 1.6;
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .status-indicator.show {
            transform: translateX(0);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .empty-text {
            font-size: 16px;
            line-height: 1.6;
            max-width: 400px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                margin: 10px;
                border-radius: 15px;
            }

            .sidebar {
                width: 100%;
                border-radius: 15px 15px 0 0;
            }

            .mode-selector {
                flex-wrap: wrap;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">üìä</div>
                    <div class="logo-text">Accountant AI</div>
                </div>
                <div class="tagline">Intelligent Excel Analysis System</div>
            </div>

            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text" id="uploadText">Drop Excel files here</div>
                    <div class="upload-subtext" id="uploadSubtext">or click to browse</div>
                    <input type="file" id="fileInput" class="file-input" multiple accept=".xlsx,.xls,.csv">
                </div>
            </div>

            <div class="files-list">
                <div class="files-header">
                    <span>üìã</span>
                    <span id="filesHeader">Uploaded Files</span> (<span id="fileCount">0</span>)
                </div>
                <div id="filesList"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-top">
                    <div class="header-title">Excel Analysis Dashboard</div>
                </div>
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="chat">üí¨ Chat</button>
                    <button class="mode-btn" data-mode="analysis">üìä Analysis</button>
                    <button class="mode-btn" data-mode="compare">üîÑ Compare</button>
                    <button class="mode-btn" data-mode="audit">üîç Audit</button>
                </div>
            </div>

            <!-- Chat Mode -->
            <div class="chat-container" id="chatMode">
                <div class="chat-messages" id="chatMessages">
                    <div class="empty-state">
                        <div class="empty-icon">ü§ñ</div>
                        <div class="empty-title">Welcome to Accountant AI</div>
                        <div class="empty-text">
                            <span id="emptyStateText">Upload your Excel files and start asking questions about your financial data.</span> 
                            I can help with analysis, calculations, comparisons, and generating insights.
                        </div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Ask me about your Excel data... (e.g., 'What's the total revenue in Q3?' or 'Compare expenses across all sheets')"
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" class="send-btn">
                        <span>Send</span>
                        <span>üöÄ</span>
                    </button>
                </div>
            </div>

            <!-- Analysis Mode -->
            <div class="analysis-panel" id="analysisMode">
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">üìà</div>
                            <div class="card-title">Financial Ratios</div>
                        </div>
                        <div class="card-content">
                            Calculate key financial ratios including liquidity, profitability, and efficiency metrics.
                        </div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">üìä</div>
                            <div class="card-title">Variance Analysis</div>
                        </div>
                        <div class="card-content">
                            Compare budget vs actual, identify significant variances, and analyze trends.
                        </div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üîÑ</div>
                            <div class="card-title">Cross-Reference</div>
                        </div>
                        <div class="card-content">
                            Link data across multiple spreadsheets and identify relationships.
                        </div>
                    </div>

                    <div class="analysis-card">
                        <div class="card-header">
                            <div class="card-icon" style="background: linear-gradient(135deg, #f39c12, #e67e22);">üìã</div>
                            <div class="card-title">Consolidation</div>
                        </div>
                        <div class="card-content">
                            Merge financial statements from multiple entities or time periods.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator">
        <div class="status-dot"></div>
        <span id="statusText">Connected</span>
    </div>

    <script>
        class AccountantAI {
            constructor() {
                this.files = [];
                this.ws = null;
                this.currentMode = 'chat';
                this.isConnected = false;
                
                this.initializeElements();
                this.setupEventListeners();
                this.connectWebSocket();
            }

            initializeElements() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.filesList = document.getElementById('filesList');
                this.fileCount = document.getElementById('fileCount');
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.statusIndicator = document.getElementById('statusIndicator');
                this.statusText = document.getElementById('statusText');
            }

            setupEventListeners() {
                // File upload
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.uploadArea.addEventListener('dragover', this.handleDragOver.bind(this));
                this.uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                this.uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                this.fileInput.addEventListener('change', this.handleFileSelect.bind(this));

                // Chat
                this.sendBtn.addEventListener('click', this.sendMessage.bind(this));
                this.chatInput.addEventListener('keydown', this.handleKeyDown.bind(this));
                this.chatInput.addEventListener('input', this.autoResize.bind(this));

                // Mode switching
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.switchMode(btn.dataset.mode));
                });
            }

            connectWebSocket() {
                try {
                    this.ws = new WebSocket('ws://localhost:8002/ws/chat');
                    
                    this.ws.onopen = () => {
                        this.isConnected = true;
                        this.updateStatus('Connected', true);
                    };

                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleAIResponse(data);
                    };

                    this.ws.onclose = () => {
                        this.isConnected = false;
                        this.updateStatus('Disconnected', false);
                        // Attempt to reconnect after 3 seconds
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };

                    this.ws.onerror = () => {
                        this.updateStatus('Connection Error', false);
                    };
                } catch (error) {
                    this.updateStatus('Connection Failed', false);
                }
            }

            updateStatus(text, isConnected) {
                this.statusText.textContent = text;
                this.statusIndicator.className = `status-indicator ${isConnected ? 'show' : ''}`;
                
                if (isConnected) {
                    setTimeout(() => {
                        this.statusIndicator.classList.remove('show');
                    }, 3000);
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('dragover');
            }

            handleDragLeave(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                this.processFiles(files);
            }

            handleFileSelect(e) {
                const files = Array.from(e.target.files);
                this.processFiles(files);
            }

            async processFiles(files) {
                for (const file of files) {
                    if (this.isValidFile(file)) {
                        await this.uploadFile(file);
                    }
                }
            }

            isValidFile(file) {
                const validTypes = ['.xlsx', '.xls', '.csv'];
                const extension = '.' + file.name.split('.').pop().toLowerCase();
                return validTypes.includes(extension);
            }

            async uploadFile(file) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.addFileToList(file, result.file_id);
                        this.updateStatus(window.uiTexts?.upload?.uploadSuccess || 'File uploaded successfully', true);
                    } else {
                        throw new Error('Upload failed');
                    }
                } catch (error) {
                    this.updateStatus(window.uiTexts?.upload?.uploadError || 'Upload failed', false);
                }
            }

            addFileToList(file, fileId) {
                const fileItem = {
                    id: fileId,
                    name: file.name,
                    size: this.formatFileSize(file.size),
                    file: file
                };

                this.files.push(fileItem);
                this.renderFilesList();
                this.updateFileCount();
            }

            renderFilesList() {
                this.filesList.innerHTML = this.files.map(file => `
                    <div class="file-item" data-file-id="${file.id}">
                        <div class="file-icon">üìÑ</div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${file.size}</div>
                        </div>
                        <button class="file-remove" onclick="app.removeFile('${file.id}')">√ó</button>
                    </div>
                `).join('');
            }

            removeFile(fileId) {
                this.files = this.files.filter(file => file.id !== fileId);
                this.renderFilesList();
                this.updateFileCount();
            }

            updateFileCount() {
                this.fileCount.textContent = this.files.length;
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            handleKeyDown(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage();
                }
            }

            autoResize() {
                this.chatInput.style.height = 'auto';
                this.chatInput.style.height = Math.min(this.chatInput.scrollHeight, 120) + 'px';
            }

            sendMessage() {
                const message = this.chatInput.value.trim();
                if (!message || !this.isConnected) return;

                this.addMessage(message, 'user');
                this.chatInput.value = '';
                this.autoResize();

                // Show loading state
                this.sendBtn.disabled = true;
                this.sendBtn.innerHTML = '<div class="loading"></div>';

                // Send to WebSocket
                this.ws.send(JSON.stringify({
                    content: message,
                    context: {
                        files: this.files.map(f => f.id),
                        mode: this.currentMode
                    }
                }));
            }

            handleAIResponse(data) {
                this.addMessage(data.content, 'ai');
                
                // Reset send button
                this.sendBtn.disabled = false;
                this.sendBtn.innerHTML = '<span>Send</span><span>üöÄ</span>';
            }

            addMessage(content, sender) {
                // Remove empty state if it exists
                const emptyState = this.chatMessages.querySelector('.empty-state');
                if (emptyState) {
                    emptyState.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const avatar = sender === 'user' ? 'You' : 'AI';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar.charAt(0)}</div>
                    <div class="message-content">
                        <div class="message-bubble">${content}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;

                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            switchMode(mode) {
                // Update active button
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === mode);
                });

                // Hide all panels
                document.querySelectorAll('.chat-container, .analysis-panel').forEach(panel => {
                    panel.style.display = 'none';
                });

                // Show selected panel
                if (mode === 'chat') {
                    document.getElementById('chatMode').style.display = 'flex';
                } else {
                    document.getElementById('analysisMode').style.display = 'block';
                }

                this.currentMode = mode;
            }
        }

        // Initialize the application
        const app = new AccountantAI();

        // Load all UI texts dynamically
        async function loadUITexts() {
            try {
                const response = await fetch('/api/ui-texts');
                const texts = await response.json();
                
                // Update upload section
                if (document.getElementById('uploadText')) {
                    document.getElementById('uploadText').textContent = texts.upload.dropText;
                }
                if (document.getElementById('uploadSubtext')) {
                    document.getElementById('uploadSubtext').textContent = texts.upload.browseText;
                }
                if (document.getElementById('filesHeader')) {
                    document.getElementById('filesHeader').textContent = texts.upload.filesHeader;
                }
                if (document.getElementById('emptyStateText')) {
                    document.getElementById('emptyStateText').textContent = texts.chat.emptyState;
                }
                
                // Update chat placeholder
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.placeholder = texts.chat.placeholder;
                }
                
                // Store texts globally for use in JavaScript functions
                window.uiTexts = texts;
                
            } catch (error) {
                console.error('Error loading UI texts:', error);
            }
        }

        // Load welcome message dynamically from API
        async function loadWelcomeMessage() {
            try {
                const response = await fetch('/api/welcome-message');
                const data = await response.json();
                app.addMessage(data.message, 'ai');
            } catch (error) {
                console.error('Error loading welcome message:', error);
                // Fallback message in French if API fails
                app.addMessage("Bonjour ! Je suis votre assistant comptable IA.", 'ai');
            }
        }

        // Initialize everything
        setTimeout(async () => {
            await loadUITexts();
            await loadWelcomeMessage();
        }, 1000);
    </script>
</body>
</html>
